#!/usr/bin/env bpftrace

BEGIN
{
    printf("%-8s %8s %8s %8s %8s %12s %10s\n", "TIME", "HITS", "MISSES", "DIRTIES",
		"HITRATIO", "BUFFERS_MB", "CACHED_MB");
}

kprobe:mark_page_accessed
{
    if (pid == $1) {
        @cache_hits = count();
    }
}

kprobe:add_to_page_cache_lru
{
    if (pid == $1) {
        @cache_misses = count();
    }
}

interval:s:1
{
    printf("%8lld %8lld", @cache_hits, @cache_misses);
}

END
{
    clear(@cache_hits);
    clear(@cache_misses);
}
